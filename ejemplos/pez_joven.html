<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Joven â€” franja vertical + aleta alargada</title>
<style>
  :root { --bg:#08243a; --ui:#1d4b6b; --ui2:#2a6287; --text:#e9f6ff;}
  html,body{height:100%;margin:0;background:var(--bg);}
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);overflow:hidden;}
  canvas{position:fixed;inset:0;touch-action:none}
  #bar{position:fixed;left:0;right:0;bottom:0;padding:10px;
       display:flex;gap:10px;justify-content:center;flex-wrap:wrap;
       background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0));}
  .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;
       background:var(--ui);color:var(--text);font-weight:600;cursor:pointer;
       box-shadow:0 6px 20px rgba(0,0,0,.25);display:inline-flex;gap:8px;align-items:center}
  .btn:active{transform:translateY(1px);background:var(--ui2)}
  #turbo{position:fixed;right:12px;top:12px;padding:6px 10px;border-radius:999px;
         background:rgba(255,255,255,.12);backdrop-filter:blur(4px);font-weight:700;opacity:0;transition:opacity .15s}
  #turbo.on{opacity:1}
</style>
</head>
<body>
<div id="turbo">TURBO ðŸ’¨</div>
<canvas id="tank"></canvas>
<div id="bar">
  <button class="btn" id="btnReset">â†º Reset</button>
</div>

<script>
(()=>{
const canvas=document.getElementById('tank');
const ctx=canvas.getContext('2d',{alpha:false});
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}resize();
addEventListener('resize',resize);
const turboBadge=document.getElementById('turbo');

const rand=(a,b)=>a+Math.random()*(b-a);
const lerp=(a,b,t)=>a+(b-a)*t;
const clampAngle=(a)=>{const m=70*Math.PI/180;return Math.max(-m,Math.min(m,a));};

// Burbujas de fondo
const bgBubbles=Array.from({length:26},()=>({x:Math.random()*innerWidth,y:innerHeight+Math.random()*innerHeight,r:1+Math.random()*3,s:12+Math.random()*24}));
const mouthBubbles=[];

// Config del JOVEN (un poco mÃ¡s grande, violeta medio, ojo mÃ¡s pequeÃ±o, aleta alargada)
const JOVEN={
  size:52,
  body:'#b1a1ff',    // violeta medio
  tail:'#f191cd',
  fin:'#f1c4e4',
  eyeScale:1.25,     // mÃ¡s pequeÃ±o que bebÃ©
  stripeColor:'#ffa960',
  stripeWidth:0.20   // mÃ¡s estrecha que el bebÃ©
};

let fish={
  x:canvas.width*0.5,
  y:canvas.height*0.55,
  vx:rand(90,130),
  vy:rand(-24,24),
  baseSpeed:130,
  followSpeed:270,
  wobbleT:Math.random()*10,
  angle:0,
  target:null,
  bubbleTimer:rand(0.25,0.9),
  turbo:false
};

// InteracciÃ³n: mantener pulsado = turbo + seguir dedo
let pointer=null;
canvas.addEventListener('pointerdown',e=>{pointer={x:e.clientX,y:e.clientY};fish.target=pointer;fish.turbo=true;turboBadge.classList.add('on');});
canvas.addEventListener('pointermove',e=>{if(pointer){pointer.x=e.clientX;pointer.y=e.clientY;}});
canvas.addEventListener('pointerup',()=>{pointer=null;fish.target=null;fish.turbo=false;turboBadge.classList.remove('on');});
canvas.addEventListener('pointercancel',()=>{pointer=null;fish.target=null;fish.turbo=false;turboBadge.classList.remove('on');});
document.getElementById('btnReset').onclick=()=>{
  fish.x=canvas.width*0.5; fish.y=canvas.height*0.55;
  fish.vx=rand(90,130); fish.vy=rand(-24,24);
  fish.target=null; fish.turbo=false; turboBadge.classList.remove('on');
  mouthBubbles.length=0;
};

function addMouthBubble(turboMul){
  const dir=Math.sign(fish.vx)||1;
  const mouthX=fish.x+(dir>0?JOVEN.size*0.70:-JOVEN.size*0.70);
  mouthBubbles.push({
    x:mouthX + rand(-1.0,1.0),
    y:fish.y + rand(-1.0,1.0),
    v:rand(22,36)*(turboMul?1.25:1),
    r:rand(1.2,2.6)*(turboMul?1.15:1),
    life:rand(0.9,1.5)*(turboMul?1.2:1)
  });
}

function drawStripeVertical(rx,ry,color,widthRatio){
  // Banda vertical ajustada al Ã³valo (desde lomo a barriga), no se sale
  const halfW=rx*widthRatio;
  const margin=2;
  const rxIn=rx-margin, ryIn=ry-margin;
  ctx.save(); ctx.fillStyle=color; ctx.globalAlpha=0.95; ctx.beginPath();
  const steps=56;
  for(let i=0;i<=steps;i++){
    const t=i/steps;
    const x=-halfW + t*(2*halfW);
    const y=ryIn*Math.sqrt(Math.max(0,1-(x*x)/(rxIn*rxIn)));
    if(i===0) ctx.moveTo(x,-y); else ctx.lineTo(x,-y);
  }
  for(let i=steps;i>=0;i--){
    const t=i/steps;
    const x=-halfW + t*(2*halfW);
    const y=ryIn*Math.sqrt(Math.max(0,1-(x*x)/(rxIn*rxIn)));
    ctx.lineTo(x,y);
  }
  ctx.closePath(); ctx.fill(); ctx.globalAlpha=1; ctx.restore();
}

function drawFish(time){
  const s=JOVEN.size, flip=fish.vx<0?-1:1;
  ctx.save(); ctx.translate(fish.x,fish.y); ctx.scale(flip,1); ctx.rotate(clampAngle(fish.angle));

  // Cuerpo ovalado con contorno
  const rx=s*1.05, ry=s*0.78;
  ctx.fillStyle=JOVEN.body;
  ctx.strokeStyle='rgba(0,0,0,.5)';
  ctx.lineWidth=3;
  ctx.beginPath(); ctx.ellipse(0,0,rx,ry,0,0,Math.PI*2); ctx.fill(); ctx.stroke();

  // Franja vertical (mÃ¡s estrecha)
  drawStripeVertical(rx,ry,JOVEN.stripeColor,JOVEN.stripeWidth);

  // Cola (aleteo)
  const flap=Math.sin(time*6 + fish.wobbleT)*0.36;
  ctx.save(); ctx.translate(-rx,0); ctx.rotate(flap);
  ctx.fillStyle=JOVEN.tail;
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-s*0.5, -s*0.6,  s*0.14, -s*0.24);
  ctx.quadraticCurveTo(-s*0.5,  s*0.6,  0, 0);
  ctx.fill();
  ctx.restore();

  // Aleta lateral ALARGADA
  const finFlap=Math.sin(time*8.2 + fish.wobbleT)*0.22;
  ctx.save();
  ctx.translate(-s*0.05, s*0.12);  // un poco mÃ¡s arriba y adelantada
  ctx.rotate(finFlap);
  ctx.fillStyle=JOVEN.fin;
  ctx.beginPath();
  // Alargar: mayor extensiÃ³n hacia abajo y adelante
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo( s*0.10,  s*0.80,  s*0.28,  s*0.22);
  ctx.quadraticCurveTo( s*0.08,  s*0.30,  0, 0);
  ctx.fill();
  ctx.restore();

  // Ojo (mÃ¡s pequeÃ±o que bebÃ©)
  const e=0.22 * JOVEN.eyeScale, p=0.11 * JOVEN.eyeScale;
  ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(s*0.46, 0, s*e, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(s*0.53, 0, s*p, 0, Math.PI*2); ctx.fill();

  ctx.restore();
}

let last=performance.now();
function tick(t){
  const dt=Math.min(0.033,(t-last)/1000); last=t;

  // Fondo + burbujas ambientales
  ctx.fillStyle='#08243a'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.globalAlpha=0.35; ctx.fillStyle='#cfe9ff';
  for(const b of bgBubbles){
    b.y-=b.s*dt;
    if(b.y<-10){ b.y=canvas.height+10; b.x=Math.random()*canvas.width; }
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha=1;

  // Burbujas de la boca
  for (let i=mouthBubbles.length-1;i>=0;i--){
    const m=mouthBubbles[i];
    m.y -= m.v*dt;
    m.life -= dt;
    if(m.life<=0){ mouthBubbles.splice(i,1); continue; }
    ctx.globalAlpha=Math.max(0,Math.min(1,m.life));
    ctx.strokeStyle='rgba(200,220,255,.9)';
    ctx.lineWidth=1.6;
    ctx.beginPath(); ctx.arc(m.x,m.y,m.r,0,Math.PI*2); ctx.stroke();
    ctx.globalAlpha=1;
  }

  // Movimiento
  const pad=72;
  let desiredVx=(Math.sign(fish.vx)||1)*fish.baseSpeed;
  let desiredVy=fish.vy;

  if (fish.target){
    const dx=fish.target.x-fish.x, dy=fish.target.y-fish.y;
    const len=Math.hypot(dx,dy)||1;
    const spd=fish.followSpeed*1.65;
    desiredVx=(dx/len)*spd;
    desiredVy=(dy/len)*spd;
  } else {
    fish.wobbleT += dt;
    desiredVy = fish.vy + Math.sin(fish.wobbleT*1.5)*10*dt;
  }

  // Burbujas: base + boost si turbo
  fish.bubbleTimer -= dt * (fish.target ? 2.4 : 1.0);
  if (fish.bubbleTimer <= 0){
    addMouthBubble(!!fish.target);
    if (fish.target){
      if (Math.random()<0.75) addMouthBubble(true);
      if (Math.random()<0.45) addMouthBubble(true);
    }
    fish.bubbleTimer = rand(0.5, 1.2);
  }

  // Suavizado y avance
  fish.vx = lerp(fish.vx, desiredVx, Math.min(1, dt*3.0));
  fish.vy = lerp(fish.vy, desiredVy, Math.min(1, dt*3.0));
  fish.x += fish.vx*dt;
  fish.y += fish.vy*dt;

  // Bordes
  if (fish.x < pad){ fish.x = pad; fish.vx = Math.abs(fish.vx); }
  if (fish.x > canvas.width-pad){ fish.x = canvas.width-pad; fish.vx = -Math.abs(fish.vx); }
  if (fish.y < pad*0.7){ fish.y = pad*0.7; fish.vy = Math.abs(fish.vy); }
  if (fish.y > canvas.height-pad*0.7){ fish.y = canvas.height-pad*0.7; fish.vy = -Math.abs(fish.vy); }

  // OrientaciÃ³n
  fish.angle = clampAngle(Math.atan2(fish.vy, Math.abs(fish.vx)));

  // Dibujo
  drawFish(performance.now()/1000);

  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);
})();
</script>
</body>
</html>
